\section{TLVの高速化}
TLVは，トレースログの可視化に時間がかかる．例えば，約7,000行\footnote{プロセッサを2個利用したシステムで，マルチプロセッサ対応RTOSであるTOPPERS/FMPカーネル\cite{fmp}が約252秒の間に出力した行数である．}のトレースログに対して約3分の時間を要する．約50,000行のトレースログに対しては，10時間以上という実用に耐えない時間を要した，という報告もある．

この問題に対して，OJL2期生が調査を行った\cite{mz}．結果，複雑な処理を行うメソッドが存在しており，ソースコードを複雑化させていたことが判明した．このような状況では，保守や高速化が難しいので，リファクタリングをすることになった．

問題となっているのは，標準形式トレースログのパーシングにおける正規表現の多用と可視化ルールにおける暗黙的な木構造である．

まず，前者について説明する．正規表現は，文字列のマッチングを柔軟に行えるが，どのような文字列をマッチングするのか解読するコストを要する．そのため，正規表現を多用すると，コードの可読性が低下する．

次に，後者について説明する．可視化ルールを表現するクラス群の中に，概念的に木構造となるクラスがあるが，クラス設計よって木構造で表現されていない．そのため，木構造をトラバースするためのコードが多数の場所に存在することになり，保守性と可読性が低下している．

正規表現は，標準形式トレースログを表すクラスで多用されている．このクラスは，TLVの処理で多用されるので，この問題を先に解決することにした．このリファクタリングについて，\ref{ch:refact}章で説明する．
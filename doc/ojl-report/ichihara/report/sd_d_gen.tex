\subsection{統計情報の生成・取得}\label{sec:dgen}
\subsubsection{統計情報のソースと取得・生成方法}\label{sec:dgenw}
統計情報を取得・生成するプロセスでは，まず，統計情報のソースが必要である．
考えられるソースとして，トレースログとそれ以外の形式のファイルである．
それ以外の形式のファイルとは，システムの出力，または，それ以外の方法で得られたフ
ァイルのことである．

次に，統計情報を取得・生成するプロセスでは，取得・生成する方法が必要である．
ここでいう取得とは，何らかの形で得られた統計情報をTLVが読み取ることをいい，
生成とは，ソースを解析したり，ソースにあるデータを演算を加えたりすることで統計情報を得ることをいう．ソースがトレースログの場合，トレースログにおける時系列情報を解析して統計情報を得ることが考えられる．また，システムが内部で得られた統計情報をトレースログとして出力する場合，それを読み取ることで得ることが考えられる．
ソースがトレースログ以外の形式のファイルの場合も，トレースログと同様に，ファイル内のデータを解析する，ファイルに記述されている統計情報を読み取る，といったことで統計情報を得ることが考えられる．

よって，取得・生成する具体的な方法を3種類考えた．それらを次に示す．

\begin{description}
\item[実現方法1：正規表現によるデータ取得] \mbox{} \\
文字列のマッチングなので，トレースログやそれ以外のファイルにも対応できる．
イメージを\figref{fig:seisei1}に示す．
\end{description}
\begin{figure}[h]
\begin{center}
\includegraphics[scale=0.5]{seisei1.png}
\caption{実現方法1のイメージ}
\label{fig:seisei1}
\end{center}
\end{figure}
\begin{description}
\item[実現方法2：外部プロセスによる取得・生成] \mbox{} \\
スクリプトやアプリケーションなどを外部プロセスとして利用することで，複雑な計算が
必要な統計情報も得られる．また，利用するアプリケーションさえ対応していれば，様々
なファイルから統計情報が得られる．
イメージを\figref{fig:seisei2}に示す．
\end{description}
\begin{figure}[t]
\begin{center}
\includegraphics[scale=0.6]{seisei2.png}
\caption{実現方法2のイメージ}
\label{fig:seisei2}
\end{center}
\end{figure}
\begin{description}
\item[実現方法3：TLVに実装した簡単な解析ができるメソッドによる生成] \mbox{} \\
外部スクリプトでは，開発するコストがどうしてもかかってしまう．そのため，
TLVに標準形式トレースログを簡単な解析ができるメソッドを実装することで，
外部スクリプトを利用せずに単純な統計情報が生成可能になる．
イメージを\figref{fig:seisei3}に示す．
\end{description}
\begin{figure}[h]
\begin{center}
\includegraphics[scale=0.55]{seisei3.png}
\caption{実現方法3のイメージ}
\label{fig:seisei3}
\end{center}
\end{figure}

実現方法3に関して，前述の説明だけでは理解しづらいので，詳細を述べる．

この手段をユーザに提供するに当たり，いくつかの簡単な解析ができるメソッドをTLV
に用意する必要がある．TLVでは，このメソッドを解析メソッドと呼ぶ．
\sref{sec:sd_d_gra}に示す\tabref{gtype}から，トレース
ログにおける統計情報の取り方について分析した結果，必要となるメソッドは，イベント
回数のカウント，イベント間隔の測定，測定したイベント間隔のカウントの3つで
あることがわかった．イベント回数のカウントは，タスクの起動回数などのイベントが発生した回数を数えるものである．イベント間隔の測定は，始点となるイベントから終点となるイベントまでの時間を測定するものである．割込み禁止時間などの時間に関する統計情報を得る際に必要となる．測定したイベント間隔のカウントは，ヒストグラムの生成を想定しており，イベント間隔の測定を行って得られた時間が何回あるか数えるものである．例えば，タスクの実行時間分布などで必要となる．

統計情報の取り方について分析してわかったことは他にもある．
各メソッドは，対象となるイベントを指定する必要があるが，得たい統計情報によっては
，事前条件も必要となるケースがある．例えば，タスクの起動は，タスクが休止状態から
実行可能状態になるときのことをいう．よって，タスクの起動回数を求める際の対象イベ
ントは，タスク(TASK)の状態(state)が実行可能状態(RUNNABLE)に遷移するイベント
(標準形式トレースログ形式で表現すると``TASK.state=RUNNABLE'')となる．しか
し，このイベントは，タスクが実行状態である時など複数の状態において発生する可能性
がある．よって，タスクの起動回数を求めるには，対象イベントの他に「タスクが休止状
態である」という前提条件が必要になる．こういったケースはどの統計情報にもありうる
というわけではないので，オプション設定として用意する．


\subsubsection{統計情報を得るトレースログ上の時刻区間とその指定方法}
トレースログやその他のファイルから統計情報を取得する場合，情報が静的であるので，
ソースが変わらない限り，情報は不変である．

しかし，統計情報を生成する場合，ソース内のデータの取り方によって，数値が変わってくる．トレースログにおける時系列情報を解析する場合，解析する時刻区間によって異なる．

解析する時刻区間を指定するタイミングとして，トレースログの解析作業前と解析作業中の2通りが考えられる．

まず，トレースログの解析作業前とは，TLVにトレースログなどの入力を与える前のこと
である．この状況で区間指定可能であることは，すなわち，指定する区間がすでに決まっ
ている状態である．具体的には，区間としてトレースログ全体を指定したい場合などであ
る．このような場合，統計情報を得ようとするたびに区間指定を行うのは非効率で
ある．よって，外部ファイルで区間を指定しておき，TLVに変換・可視化処理と同じタイ
ミングで統計情報を取得・生成できるようにすることで，効率化する．

次に，トレースログの解析作業中とは，TLVでトレースログを可視化している状態である
．トレースログの解析作業中には，解析を容易にするために，ある一部区間のみの統計情
報が必要になることがある．よって，可視化後も区間を入力して統計情報を得られるよう
にする．また，このケースでは，可視化されたトレースログを扱っているため，GUIを用
いてグラフィカルに指定できるようにすることで，利用しやすくする．

トレースログ以外のファイルでも，ソース内のデータの取り方によって数値が変わってく
るが，ソース内のデータや形式が一意に定まらないため，トレースログの解析と同様の機
能はTLVで実現しないことにする．
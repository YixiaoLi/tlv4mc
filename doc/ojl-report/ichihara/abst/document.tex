

\section{背景}
近年，省電力で高パフォーマンスを実現できる
マルチプロセッサの利用が増加している．
マルチプロセッサ環境でのデバッグは，実行履歴であるトレースログを
解析することで行われるが，膨大な量となるため，
テキストの状態で処理を追跡するのは困難である．よって，
トレースログの可視化ツールが用いられる．しかしながら，このツールは，ターゲット
システム専用に用意されることが多く，汎用性に乏しい．
また，可視化する情報や表現する図形が限定的であり，拡張性に乏しい．
これらを解決するため，第1期OJLにてTraceLogVisualizer(TLV)\cite{ipsj}が開発された．

第3期OJLでは，ユーザのTLVに対する要求を収集した．その中に，次のような問題があり，
それを解決する機能を求めるものがあった．

トレースログの解析において、あるイベントが何回行われたのか，
などのトレースログの統計情報が必要になる．
TLVでは，トレースログの時系列情報を扱うツールであり，こうした統計情報は，
手作業や独自に開発したスクリプトなどで得る必要がある．手作業で行う場合，
トレースログを可視化したとしてもコストがかかり，見落としなどで
正確性に欠ける．さらに，得た統計情報をグラフ化するためにグラフ作成ツールを
使用する必要があり，解析作業が非効率であった．

よって，この問題を解決する機能として，
トレースログから統計情報を生成してグラフとして表示する機能の実装を行った．

\section{TraceLogVisualizer(TLV)}
TLVは，各種リアルタイムOS(RTOS)やシミュレータなどが
出力するトレースログを図\ref{fig:tlv}のように可視化表示するツールである. 
TLVは，形式が異なるトレースログを変換ルールに従って，独自形式である標準形式トレースログに変換し，その標準形式トレースログに対して可視化ルールを適用することによって可視化表示する．変換ルール・可視化ルールは，ユーザが自由に記述できるため，様々な形式のトレースログや様々な可視化方法を扱うことが可能である．トレースログ内の各種リソース情報は，リソースファイルとして別途読み込む．このリソースファイルは，RTOSのコンフィギュレーション段階で自動生成するほか，手動で記述することも可能である．

\begin{figure}[t]
 \begin{center}
  \includegraphics[width=0.4\textwidth]{tlv.png}%{tlv.eps}
  \caption{TLVのスクリーンショット}
  \label{fig:tlv}
 \end{center}
\end{figure}

\section{統計情報表示機能}
\subsection{概要}
統計情報表示機能とは，トレースログやその他のデータソースから，
トレースログの統計情報を取得，または，生成し，その統計情報をグラフとして表示する機能である．
トレースログの統計情報の例を以下に示す．
\begin{itemize}
\item タスクのCPU利用率
\item タスクのディスパッチ回数
\item タスクの実行時間分布
\end{itemize}

\subsection{処理プロセス}
処理プロセスは，統計情報取得・生成プロセスとグラフ設定プロセス
の2つのサブプロセスからなり，成果物としてグラフ設定と統計情報を保持する統計情報ファイルを出力し，それを専用ビューアで表示する．その流れを図\ref{fig:statspro}に示す．
\begin{figure}[H]
 \begin{center}
  \includegraphics[width=0.4\textwidth]{stats_process.png}
  \caption{統計情報表示機能の処理プロセス}
  \label{fig:statspro}
 \end{center}
\end{figure}
統計情報取得・生成プロセスでは，生成モードと呼ばれる，統計情報を記録したデータソースから統計情報を取得する方法やトレースログなどから統計情報を生成する方法に従って統計情報を得る．グラフ設定プロセスでは，軸のタイトルや目盛幅などのグラフに関する設定を行う．
生成モードの選択やグラフ設定などの，各プロセスの動作は，統計情報生成ルールで定義する．

TLVファイルは，従来のTLVから存在するもので，TLVの成果物をまとめたZIP形式ファイルである．
統計情報表示機能でもこれを利用することで，統計情報の再取得を行わずに済む．
また，ZIP形式なのでファイルを解凍すれば，統計情報を他のアプリケーションで用いることが可能である．

従来のTLVの処理からの変更を図\ref{fig:tlvpro}に示す．図\ref{fig:statspro}に示したプロセスは，図形生成プロセス後に実行される．
そして，リソースファイルに統計情報生成ルールを指定することで，ユーザが直接入力するファイル数と回数を抑えることができる．
\begin{figure}[t]
 \begin{center}
  \includegraphics[width=0.4\textwidth]{tlv_addstats.png}
  \caption{従来のTLVの処理プロセスからの変更}
  \label{fig:tlvpro}
 \end{center}
\end{figure}

\subsection{統計情報生成ルール}
統計情報生成ルールは，生成モードとグラフの設定を定義するものである．
定義には，変換・可視化ルールと同様にJavaScript\ Object\ Notation(JSON)を用いる．
JSONの他にも，従来のTLVに合わせられる箇所は，可能な限り合わせることで，
ユーザの機能の習得性向上，保守性向上に努めた．

\subsection{生成モード}
統計情報のソースとなるファイルや用途に合わせて選択できるように，生成モードを4種類を用意した．
\subsubsection{データ読み取りモード}
トレースログなどのデータソースから，正規表現を用いて統計情報を取得する生成モードである．
対象となるソースファイルは，トレースログ，標準形式トレースログ，その他のファイルである．
これは，ターゲットシステムが内部で求めた統計情報をトレースログに出力するケースや
別のデータファイルに出力するケースに利用する．

\subsubsection{スクリプト拡張モード}
外部プロセスに統計情報の取得・生成を依頼する生成モードである．
対象となるソースファイルは，トレースログ，標準形式トレースログ，その他のファイルである．
複雑な方法で取得・生成する場合，この生成モードを利用する．
スクリプトの仕様は，入力としてソースファイルのいずれかとリソースファイル，
出力として統計情報ファイルを満たすものであればよい．

\subsubsection{基本解析モード}
TLVに新たに実装した，解析メソッドと呼ばれるものを使用して統計情報を生成する標準形式トレースログを解析して統計情報を得る生成モードである．解析メソッドとは，標準形式トレースログを解析して統計情報を得るメソッドのことである．解析メソッドとして，イベント回数のカウント，イベント間隔の計測を行えるものを用意した．この生成モードは，単純な方法で統計情報を生成できる場合に有用で，スクリプトを開発するコストを削減できる．

\subsubsection{統計情報ファイル入力モード}
何らかの形で入手した統計情報ファイルをTLVに入力する生成モードである．特別な処理を施さないので，他の生成モードとは性質が異なるが，統計情報ファイルを入力する方法も有用なため，このような形で実現した．

\subsection{統計情報のグラフ表示}
統計情報ビューアは，統計情報ファイルに含まれるグラフ設定と統計情報を用いて，統計情報のグラフ表示を行う．表示例を図\ref{fig:viewer}に示す．表現するグラフの種類は，ビューア上部にあるコンボボックスで選択できる．
対応しているグラフは，円グラフ，縦棒グラフ，横棒グラフ，折れ線グラフ，ヒストグラムである．これらは，TLVユーザ2名から頂いたアンケート結果をもとに選別した．

\begin{figure}
 \begin{center}
  \includegraphics[width=0.3\textwidth]{aspsampledis.png}
  \caption{統計情報ビューア}
  \label{fig:viewer}
 \end{center}
\end{figure}

\section{スケジュール}
\begin{figure}[h]
 \begin{center}
  \includegraphics[width=0.4\textwidth]{sch.png}
  \caption{統計情報表示機能の開発スケジュール}
  \label{fig:sch}
 \end{center}
\end{figure}
スケジュールを図\ref{fig:sch}に示す．
4月当時の計画では，統計情報表示機能と表示方法が類似する機能を
8月までに完成させ，9月から統計情報表示機能の設計に入る予定であった．しかしながら，4月から5月にかけて，他タスクと実現可能性調査・要件定義が重なり，思うように進められなかった．また，TLVの設計書などのドキュメントが乏しいために実現可能性調査に時間がかかってしまったこと，自分のコミュニケーション力の低さによるメンバとの正確な意見交換ができなかったこと，ドメイン知識と要求工学に対する知識不足なども遅れの原因だと考えられる．
また，実装の遅延は，見積もりの甘さによるものである．


\section{所感}
第3期OJLでは，コミュニケーションの大切さ・難しさ，ドキュメントの重要性，プロジェクト管理の難しさを痛感した．
 ドメイン知識がなかったので，ユーザや知識のある方とのコミュニケーションを積極的にとる必要性を学んだ．また，ドキュメント作成においては，説明するのに適切な図を選び，正しく使用することがよくできず，スケジュールの遅れにつながってしまった．過去の経験がないため，作業の細分化と見積もりがうまくいかず苦労した．
しかしながら，こういった失敗の経験や，企業目線での意見や考え方にふれながらの作業という，通常のコースでは味わえない経験は，次のステップへのいい教訓となった．

\begin{thebibliography}{9}
\begin{small}
\bibitem{ipsj}
後藤隼弐,
本田晋也,
長尾卓哉,
高田広章，トレースログ可視化ツールTraceLogVisualizer(TLV)，コンピュータ\ ソフトウェア，Vol.27，No.4，pp.8-23，Nov\ 2010.
\end{small}
\end{thebibliography}
\end{document}
